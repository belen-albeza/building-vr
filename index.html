<!DOCTYPE html>
<head>
  <title>Building VR experiences with A-Frame</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <link rel="stylesheet" href="minideck/minideck.css" type="text/css">
  <script src="minideck/minideck.js"></script>
  <script src="minideck/vendor/highlight.js"></script>
  <link rel="stylesheet" href="minideck/vendor/highlight.css" type="text/css">
  <link rel="stylesheet" href="minideck/simple-theme.css" type="text/css">
</head>
<body>
  <article id="deck">
    <header>
      <progress></progress>
    </header>
    <section class="title">
      <h1>Building VR experiences with A-Frame</h1>
      <p>Belén Albeza</p>
      <p><a href="https://belenalbeza.com">belenalbeza.com</a>&nbsp;//&nbsp;<a href="https://twitter.com/ladybenko">@ladybenko</a></p>
      <p class="breathe">Deck:<br><a href="https://belen-albeza.github.io/building-vr">https://belen-albeza.github.io/building-vr</a></p>
    </section>
    <section>
      <h1>Why VR in the Web?</h1>
      <ul>
        <li>The power of an URL</li>
        <li>You can leverage your existing know-how</li>
      </ul>
    </section>
    <section>
      <h1>Which browsers?</h1>
      <ul>
        <li>Firefox, Chrome, Samsung Internet, Edge</li>
        <li>Check the status at <a href="https://webvr.rocks/">webvr.rocks</a></li>
        <li>Polyfill other browsers</li>
      </ul>
    </section>
    <section>
      <h1>Which headsets?</h1>
      <ul>
        <li>HTC Vive</li>
        <li>Oculus Rift</li>
        <li>Samsung Gear</li>
        <li>Daydream</li>
      </ul>
    </section>
    <section>
      <h1>The WebVR API</h1>
      <ul>
        <li>It's an <b>standard</b> API (<a href="https://w3c.github.io/webvr/">spec at W3C</a>)</li>
        <li>It doesn't <em>render</em>, but provides the data to do it</li>
        <li>We can get:
          <ul>
            <li>Characteristics of the headset</li>
            <li>The pose</li>
            <li>The stage</li>
            <li>VR controllers input</li>
          </ul>
        </li>
      </ul>
    </section>
    <section>
      <h1>Tools to author VR content</h1>
      <ul>
        <li>THREE.js</li>
        <li>Some game engines (Unity, PlayCanvas…)</li>
        <li>A-Frame!</li>
      </ul>
    </section>
    <section class="bg-aframe">
      <h1>A-Frame</h1>
      <ul>
        <li><a href="https://aframe.io">aframe.io</a></li>
        <li>It's a WebVR framework that simplifies <i>a lot</i> creating VR experiences</li>
        <li>Created at Mozilla, open-source</li>
      </ul>
    </section>
    <section>
      <h1>Creating a VR scene is easy…</h1>
      <pre><code class="language-html">&lt;a-scene&gt;
    &lt;a-sphere radius="1" position="0 1 -4" color="#ff0040"&gt;
    &lt;/a-sphere&gt;

    &lt;a-plane rotation="-90 0 0" position="0 0 -5" width="10"
        height="10" color="#fff"&gt;
    &lt;/a-plane&gt;

    &lt;a-sky color="#eee">&lt;/a-sky&gt;
&lt;/a-scene&gt;</code></pre>
    </section>
    <section>
      <iframe class="demo" src="demos/basic_scene.html"></iframe>
    </section>
    <section>
      <h1>Advantages of this approach</h1>
      <ul>
        <li>It's in the <b>DOM</b>! <code>querySelector</code>, etc. work!</li>
        <li>You can manipulate the scene with JS by adding, removing and modifying these DOM elements</li>
        <li>You can use existing tools and frameworks (such as a template library)</li>
      </ul>
    </section>
    <section>
      <h1>Which primitives we have?</h1>
      <ul>
        <li>3D primitives: <code>a-sphere</code>, <code>a-box</code>, <code>a-torus</code>…</li>
        <li>Images and video: <code>a-video</code>, <code>a-videosphere</code>, 
          <a-image></a-image>…
        </li>
        <li>Other: <code>a-gltf</code>, <code>a-text</code>, <code>a-light</code>, <code>a-sound</code>…</li>
      </ul>
    </section>
    <section>
      <h1>The ECS pattern</h1>
      <ul>
        <li>Entity-Component-System</li>
        <li>Favors compoistion over inheritance</li>
        <li>Entities (<code>a-entity</code>, <code>a-box</code>…): barebones structure</li>
        <li>Component (<code>position</code>, <code>color</code>…): attached to entities</li>
        <li>System: handles business logic of components</li>
      </ul>
    </section>
    <section>
      <h1>A-Painter</h1>
      <p class="center">VR drawing app</p>
      <iframe class="figure" width="560" height="315" src="https://www.youtube.com/embed/DpWOKikos7Q"></iframe>
    </section>
    <section>
      <h1>A-Blast</h1>
      <p class="center">Arcade game</p><img class="figure" src="images/a-blast.gif">
    </section>
    <section>
      <h1>Let's make a demo!</h1>
      <ul>
        <li>It leverages A-Frame's entity-component-system</li>
        <li>It uses A-Frame's asset manager</li>
        <li>It synthesizes chords with the Web Audio API</li>
        <li>It uses positional audio</li>
      </ul>
    </section>
    <section>
      <h1>Step 1: The barebones</h1>
      <ul>
        <li>We are creating the basic, static elements of the scene</li>
        <li>We are setting the sky to be (temporarily) red</li>
      </ul>
    </section>
    <section>
      <pre><code class="language-html">&lt;a-scene&gt;
    &lt;a-camera position="0 1 0"&gt;&lt;/a-camera&gt;

    &lt;a-circle rotation="-90 0 0" radius="10" color="#fff"
        transparent opacity="0.5"&gt;&lt;/a-circle&gt;

    &lt;a-sky color="red"&gt;&lt;/a-sky&gt;
&lt;/a-scene&gt;</code></pre>
    </section>
    <section>
      <iframe class="demo" src="demos/sound_01.html"></iframe>
    </section>
    <section>
      <h1>Step 2: the asset manager</h1>
      <ul>
        <li>A-Frame incorporates an asset manager so it loads images, audio files, models, etc.</li>
        <li>We don't need to listen to <code>load</code> events, etc.</li>
        <li>Use <code>a-assets</code></li>
        <li>We are going to use an image in the sky</li>
      </ul>
    </section>
    <section>
      <pre><code class="language-html">&lt;a-scene&gt;
    &lt;a-assets&gt;
        &lt;img id="city" src="city.jpg"&gt;
    &lt;/a-assets&gt;

    &lt;!-- ... --&gt;

    &lt;a-sky src="#city"&gt;&lt;/a-sky&gt;
&lt;/a-scene&gt;</code></pre>
    </section>
    <section>
      <iframe class="demo" src="demos/sound_02.html"></iframe>
    </section>
    <section>
      <h1>Step 3: Create the pillars procedurally</h1>
      <ul>
        <li>Why? DRY and we don't need to manually calculate positions</li>
        <li>We can just use the standard API's to manipulate the DOM</li>
        <li><code>Document.createElement</code>, <code>Element.appendChild</code>, <code>Element.setAttribute</code>…</li>
        <li>We will create <code>a-cylinder</code> instances and attach them to the scene</li>
      </ul>
    </section>
    <section>
      <pre><code class="language-js">const PILLARS = [
    { color: 'rgb(253, 162, 40)' },
    { color: 'rgb(254, 229, 65)' },
    { color: 'rgb(35, 224, 64)' },
    // ...
];
</code></pre>
    </section>
    <section>
      <pre><code class="language-js">const RADIUS = 5;

PILLARS.forEach(function (p, index, arr) {
    let angle = index * (2 * Math.PI / arr.length);
    let x = Math.cos(angle) * RADIUS;
    let z = Math.sin(angle) * RADIUS;

    let el = document.createElement('a-cylinder');
    el.setAttribute('position', `${x} 0 ${z}`);
    el.setAttribute('color', p.color);

    document.querySelector('a-scene').appendChild(el);
});</code></pre>
    </section>
    <section>
      <iframe class="demo" src="demos/sound_03.html"></iframe>
    </section>
    <section>
      <h1>Step 4: Create a component</h1>
      <ul>
        <li>For now it will animate the entity by nesting an <code>a-animation</code><br><small>(later on it will play a chord)</small></li>
        <li>The component will hold the <b>data</b> to operate</li>
        <li>The system will provide the <b>behaviour</b></li>
      </ul>
    </section>
    <section>
      <pre><code class="language-js">AFRAME.registerComponent('pipe', {
    schema: {
        chord: { type: 'string', default: 'C4' },
        dur: { type: 'number', default: 2000 }
    },
    init: function () {
        this.el.appendChild(this.system.createAnimation(this.data));
    },
});</code></pre>
    </section>
    <section>
      <pre><code class="language-js">AFRAME.registerSystem('pipe', {
    createAnimation: function (data) {
        let anim = document.createElement('a-animation');

        anim.setAttribute('attribute', 'scale');
        anim.setAttribute('dur', data.dur / 3);
        anim.setAttribute('from', '1 1 1');
        // more attribute setup here
        // ...

        return anim;
    }
});</code></pre>
    </section>
    <section>
      <pre><code class="language-js">const PILLARS = [
    { chord: 'C4', color: 'rgb(253, 162, 40)', dur: 2500 },
    // ...
];

PILLARS.forEach(function (p, index, arr) {
    // ...
    // ex: &lt;a-cylinder pipe="chord: C4; dur: 2500"&gt;
    el.setAttribute('pipe', `chord: ${p.chord};
        ${p.dur ? 'dur: ' + p.dur : '' }`);
    // ...
});
</code></pre>
    </section>
    <section>
      <iframe class="demo" src="demos/sound_04.html"></iframe>
    </section>
    <section>
      <h1>Step 5: play sounds</h1>
      <ul>
        <li>We have an audio synth created with Web Audio</li>
        <li>It can play major chords (3 notes at the same time)</li>
        <li>A note is a wave with a given frequency (ex: A4 is 440 Hz)</li>
        <li>It can handle positional audio</li>
      </ul>
    </section>
    <section>
      <pre><code class="language-js">AFRAME.registerSystem('pipe', {
    init: function () {
        this.ctx = new AudioContext();
        this.instrument = new Instrument(this.ctx);
    },
    // ...
};</code></pre>
    </section>
    <section>
      <pre><code class="language-js">AFRAME.registerSystem('pipe', {
    // ...
    playChord: function (entity) {
        let data = entity.components.pipe.data;

        let position = entity.getAttribute('position');
        let rotY = // ... camera rotation
        let orientation = // ... orientation to camera

        this.instrument.playChord(data.chord, data.dur / 1000,
            position, orientation);

        entity.emit('sound');
    },
    //...
};</code></pre>
    </section>
    <section>
      <iframe class="demo" src="demos/sound_05.html"></iframe>
    </section>
    <section>
      <h1>Final step: orchestrate!</h1>
      <ul>
        <li>Systems have a <code>tick</code> callback, which is executed every frame</li>
        <li>We will use it to select a random pillar and play it, once the previous note has finished</li>
        <li>The system now needs to track every existing component</li>
      </ul>
    </section>
    <section>
      <pre><code class="language-js">AFRAME.registerSystem('pipe', {
    init: function () {
        this.entities = [];
        // ...
    },
    subscribe: function (el) {
        this.entities.push(el);
    },
    unsubscribe: function (el) {
        let index = this.entities.indexOf(el);
        this.entities.splice(index, 1);
    },
    // ...
};</code></pre>
    </section>
    <section>
      <pre><code class="language-js">AFRAME.registerSystem('pipe', {
    // ...
    tick: function () {
        let timestamp = this.ctx.currentTime;

        if (timestamp - this.lastNoteTime > this.lastNoteDuration) {
            let entity = this.entities[
                Math.floor(Math.random() * this.entities.length)];

            this.lastNoteDuration = this.playChord(entity);
            this.lastNoteTime = timestamp;
        }
    },
    // ...
};</code></pre>
    </section>
    <section>
      <iframe class="demo" src="demos/index.html"></iframe>
    </section>
    <section>
      <h1>Try A-Frame yourself!</h1>
      <ul>
        <li>Get started at <a href="http://aframe.io">aframe.io</a></li>
        <li>Mozilla's A-Frame codepens <a href="http://codepen.io/mozvr/">codepen.io/mozvr</a></li>
      </ul>
    </section>
    <section class="center">
      <h1>Thanks!</h1>
      <h2>Questions?</h2>
      <p class="breathe"><a href="https://twitter.com/ladybenko">@ladybenko</a></p>
      <p class="breathe-xxl">Source code: <br><a href="https://github.com/belen-albeza/building-vr">https://github.com/belen-albeza/building-vr</a></p>
    </section>
  </article>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
        let deck = new MiniDeck(
            document.querySelectorAll('#deck > section'),
            document.querySelector('#deck progress'));
    });
    
    if (hljs) { hljs.initHighlightingOnLoad();  }
  </script>
</body>